# key_handler サブモジュール

## 概要

キーボード入力の処理を担当するサブモジュール。連続キー押下に対応し、スムーズなプレイヤー操作を実現します。

## 主な機能

- **キー状態追跡**: キーの押下・解放状態を配列で管理
- **連続キー処理**: 毎フレーム押されているキーに応じて処理を実行
- **複数キー同時押し対応**: 斜め移動など複数キーの同時操作が可能
- **クロスプラットフォーム対応**: macOS/Linuxで異なるキーコードと終了処理に対応

## ファイル構成

```
srcs/engine/key_handler/
└── key_handler.c              # 入力処理の実装

includes/engine/
└── key_handler.h              # 公開インターフェース
```

## 主要な関数

### handle_keypress / handle_keyrelease
キーの押下・解放イベントを `game->keys[256]` 配列に記録

### process_held_keys
毎フレーム呼ばれ、押されているキーに応じてプレイヤー操作関数を実行

### close_window
ウィンドウを閉じる処理（プラットフォーム固有の終了処理）

## 動作の仕組み

```
ユーザーがキーを押す
    ↓
handle_keypress() が keys[keycode] = 1 に設定
    ↓
毎フレーム process_held_keys() が実行
    ↓
keys[] をチェックして押されているキーに応じた処理
    ↓
ユーザーがキーを離す
    ↓
handle_keyrelease() が keys[keycode] = 0 に設定
```

この方式により、OSのキーリピート設定に依存せず、フレームレートに同期した安定した入力処理が可能になります。

## 対応するキー

| キー | 動作 |
|------|------|
| W | 前進 |
| S | 後退 |
| A | 左移動 |
| D | 右移動 |
| 左矢印 | 左回転 |
| 右矢印 | 右回転 |
| ESC | 終了 |

## 詳細設計

詳細は [design.md](./design.md) を参照してください。

## 関連モジュール

- [player](../player/README.md) - プレイヤー操作関数を提供
- [engine](../README.md) - ゲームループを管理